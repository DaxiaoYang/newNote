# Computer Systems A Programmer's Perspetive

[TOC]

## Chapter 1: 漫游计算机系统

### 信息 = 位 + 上下文

```c
// hello.c
#include <stdio.h>

int main () {
    printf("hello world\n");
    return 0;
}
```

`hello.c` 是一个文本文件 是由一连串bit组成的

同一串bit在不同的上下文中，表示的意思是不一样的



### 源文件到可执行文件

从源文件`hello.c` 到可执行文件`hello`的过程

1. 预处理：hello.c -> hello.i，将`#include<stdio.h>`这部分头文件的代码插入到源代码中

2. 编译：hello.i -> hello.s 生成汇编代码

3. 汇编：hello.s -> hello.o 将汇编语言翻译为机器语言指令，生成可重载对象程序

4. 链接：将print.o与hello.o链接起来 形成hello可执行文件

   > 可执行文件可以被加载入内存并被系统执行



### 了解编译系统如何工作的好处

- 提高程序性能
- 理解链接时错误
- 避免安全漏洞



### 处理器读取或翻译存储在内存中的指令

系统的硬件组成：

- 总线：64bit的系统 -> 总线的传输的字的长度是64bit 

- IO设备

- 主内存：临时存储处理器执行程序所需的程序和数据的地方 由DRAM组成，逻辑上是一个线性的字节数组

- 处理器：寄存器 + PC，重复地执行PC指向的指令并更新PC的值

  `helloworld`程序执行过程：

  - 可执行文件通过DMA，直接从磁盘加载到内存
  - CPU从内存中取出数据 并写到外设中



### 缓存

**矛盾**：处理器的处理速度远远快于从内存中取数据的速度

解决方法：利用局部性原理，在CPU和内存之间加上多级缓存，每一层存储设备都是下一层存储设备的缓存



### 操作系统：管理硬件



软件：

- 应用程序
- 操作系统

硬件：

- 处理器
- 内存
- IO设备



操作系统提供的抽象：

- 进程 = 处理器 + 内存 + IO设备

  进程的上下文切换由操作系统内核进行 

  内核：系统用来管理所有进程的代码和数据结构的集合

- 虚拟内存 = 内存 + IO设备

  组成：从地位到高位分布

  - 应用程序代码和数据
  - 堆
  - 共享库
  - 栈
  - 内核虚拟内存：留给内核使用 应用程序无法直接读写这块内存

- 文件 = IO设备



### 重要的主题

`Amdahl's Law`

系统中某个部分的速度提升对整个系统的速度的提升的影响取决于两个因素：

- 部分提升的幅度
- 部分在整体中占的百分比

Tnew = (1 - a)Told + aTold/k

->

Told/Tnew = 1/ (1 - a + a/k)

> a为部分在系统中的占比 
>
> k为部分提升的幅度



## 程序结构和执行

## 信息的表示和处理

寻址和字节序：

对于一个跨越多个字节的程序对象，需要确定2个问题

- 对象地址是什么：首地址 字节最小的地址

- 内存中如何排列这些字节：

  - 大端法：权重最高的字节放在最前面

  - 小端法：权重最低的字节放在最前面

    0x01234567

    ![image-20220622074327034](https://daxiao-img.oss-cn-beijing.aliyuncs.com/img/202206220743109.png)



整数表示：

- 无符号数
- 有符号数：补码，最高位的权重为负



浮点数：浮点数是一个有限的集合 实数是无限的 所以只能近似的表示

V = (-1)^s * M * 2^E

科学计数法的二进制版本 

- s：符号
- M：尾数 一个二进制小数 0.xxx 或者 1.xxx
- E：阶码

