# Web协议详解与抓包实战



## HTTP/2协议

**HTTP1.1面临的挑战**：

- 消息大小增加 KB -> MB
- html页面中资源数量增加
- 内容从文本 -> 富媒体（图片 音视频）
- 对页面实时性要求更高



**HTTP1.1存在的问题**

- 带宽增加了 但是延迟并没有降低

  单连接中的串行请求 

  同一个连接中 只有一个http事务结束后 才能处理下一个事务

  没办法做到多路复用

- 无状态导致重复的http头部的传输

- 不支持服务器推送消息



**HTTP/2特性**

- 传输数据量减少

  头：压缩

  内容：二进制

- 多路复用

- 服务器消息推送



**HTTP/2核心概念**

- Connection：对应一个TCP连接
- Stream：逻辑概念 一个Connection中可以有多个Stream Stream之间是可以并发的 Stream是可以双向通讯的数据流
- Message：对应http1中的请求/响应
- Frame：一个Message可以由多个Frame组成 以二进制方式存放http/1中的内容（头部或者体）

![image-20230515070056999](https://daxiao-img.oss-cn-beijing.aliyuncs.com/img/202305150700102.png)



**Stream ID的作用**

- 实现多路复用

  接收端可以根据stream id来重新组装message

- 可以区别服务端和客户端的流 用于实现服务端推送

  客户端：奇数

  服务端：偶数

- 可以区分出控制帧

  stream id = 0



**对header部分采用hpack进行压缩**

关键思想：

- 通信双方对重复出现的字符串value 用一个索引key表示 之后只传key
- 对字符串进行哈夫曼编码 减少传送的字节数



组成：

- 静态表

  写死的 index -> 常用的请求头

- 动态表

  连接双方动态添加的

  发送和接收到不认识的请求头时 添加上去

- 哈夫曼编码



